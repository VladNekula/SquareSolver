#include <TXLib.h>
#include <stdio.h>
#include <math.h>

struct NumbersForTest {
    double a, b, c;
    int solution;
    double x1, x2;
};

NumbersForTest numbersForTestArray[] = {
    {.a = 1,.b = -5,.c = 6,.solution = 2,.x1 = 2,.x2 = 3},
    {.a = 1,.b = 1,.c = 1,.solution = 0,.x1 = NAN,.x2 = NAN},
    {.a = 1,.b = -4,.c = 4,.solution = 1,.x1 = 2,.x2 = 2},
    {.a = 0,.b = 0,.c = 0,.solution = 0,.x1 = NAN,.x2 = NAN},
    {.a = 1,.b = -5,.c = 6,.solution = 2,.x1 = 3,.x2 = 2}
};

const double EPSILON = 0.00001;
const int LENGTH_ARRAY = sizeof(numbersForTestArray) / sizeof(numbersForTestArray[0]);

double Discriminant(double a, double b, double c);
int SolveSquare(double a, double b, double c, double* x1, double* x2);
bool IsEqual(double number1, double number2);
void SolveTest(double* x1, double* x2);

int main() {
    double x1 = NAN, x2 = NAN;
    SolveTest(&x1, &x2);
    return 0;
}

double Discriminant(double a, double b, double c) {
    return b * b - 4.0 * a * c;
}

bool IsEqual(double number1, double number2) {
    return fabs(number2 - number1) < EPSILON;
}

int SolveSquare(double a, double b, double c, double* x1, double* x2) {
    if (IsEqual(a, 0) && IsEqual(b, 0)) {
        *x1 = NAN;
        *x2 = NAN;
        return 0;
    }
    else if (IsEqual(a, 0)) {
        *x1 = -c / b;
        *x2 = *x1;
        return 1;
    }
    else if (IsEqual(b, 0)) {
        double t = -c / a;
        if (t < 0) {
            *x1 = NAN;
            *x2 = NAN;
            return 0;
        }
        else {
            *x1 = -sqrt(t);
            *x2 = sqrt(t);
            if (IsEqual(*x1, *x2)) {
                return 1;
            }
            else {
                return 2;
            }
        }
    }

    double D = Discriminant(a, b, c);
    if (D < 0) {
        *x1 = NAN;
        *x2 = NAN;
        return 0;
    }
    else if (IsEqual(D, 0.0)) {
        *x1 = -b / (2.0 * a);
        *x2 = *x1;
        return 1;
    }
    else {
        double n1 = - b / (2.0 * a);
        double n2 = sqrt(D) / (2.0 * a);

        *x1 = n1 - n2;
        *x2 = n1 + n2;
        return 2;
    }
}

void SolveTest(double* x1, double* x2) {
    extern NumbersForTest numbersForTestArray[LENGTH_ARRAY];
    for (int i = 0; i < LENGTH_ARRAY; i++) {
        int solution = SolveSquare(numbersForTestArray[i].a, numbersForTestArray[i].b, numbersForTestArray[i].c, x1, x2);

        bool isCorrect = false;

        if (solution != (int)numbersForTestArray[i].solution) {
            isCorrect = false;
        }
        else if (solution == 0) {
            isCorrect = isnan(*x1) && isnan(*x2);
        }
        else {
            isCorrect = (IsEqual(*x1, numbersForTestArray[i].x1) && IsEqual(*x2, numbersForTestArray[i].x2)) || (IsEqual(*x1, numbersForTestArray[i].x2) && IsEqual(*x2, numbersForTestArray[i].x1));
        }

        if (!isCorrect) {
            printf("Error: SolveSquare(%g, %g, %g) -> %d, x1 = %g, x2 = %g "
                   "(should be %g, x1 = %g, x2 = %g)\n",
                   numbersForTestArray[i].a, numbersForTestArray[i].b, numbersForTestArray[i].c,
                   solution, *x1, *x2,
                   numbersForTestArray[i].solution, numbersForTestArray[i].x1, numbersForTestArray[i].x2);
        }
        else {
            printf("Correct: SolveSquare(%g, %g, %g) -> %d, x1 = %g, x2 = %g\n",
                   numbersForTestArray[i].a, numbersForTestArray[i].b, numbersForTestArray[i].c,
                   solution, *x1, *x2);
        }
    }
}
